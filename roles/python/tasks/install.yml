---
- include: 'install-{{ ansible_os_family }}.yml'

- name: download and extract python source
  unarchive: >
    src={{ python_source_url }}
    copy=no
    dest={{ python_source_dest }}

- name: compile and install
  shell: '{{ item }}'
  args:
    chdir: '{{ python_source_dir }}'
  with_items:
    - './configure --prefix={{ python_prefix }}'
    - 'make'
    - 'make install'

- name: delete source files
  file: path={{ python_source_dir }} state=absent

- name: normalize python exec name
  shell: 'mv python? python || true'
  args:
    chdir: '{{ python_prefix }}/bin'

- name: normalize pip exec name
  shell: 'mv pip? pip || true'
  args:
    chdir: '{{ python_prefix }}/bin'
